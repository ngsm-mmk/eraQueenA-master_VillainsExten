;EVENT_A.ERB、EVENT_ABILITY、能力や素質の変化イベント
@EVENTCHECK_ABL

SIF TARGET >= 0
	CALL EVENTCHECK_T

SIF MASTER >= 0
	CALL EVENTCHECK_M

SIF ASSI >= 0
	CALL EVENTCHECK_A



;---------------------------------------------------------
;陷落素質
;---------------------------------------------------------
;陷落素質の多重取得を封印
@EVENTCHECK_T
IF TALENT:3 == 0 && TALENT:4 == 0 && TALENT:5 == 0 && TALENT:6 == 0 && TALENT:7 == 0 && TALENT:8 == 0 && TALENT:9 == 0 && TALENT:162 == 0
	;被调教经验の合計からマスター调教の经验を引いて助手调教经验を算出
	A = 0
	REPEAT CHARANUM
		A += CFLAG:(NO:COUNT + 1199)
	REND
	DEBUGPRINTFORML 总被调教经验：{A}
	A -= CFLAG:(NO:MASTER + 1199)
	DEBUGPRINTFORML 助手调教经验：{A}
	
	
	;恋慕：顺从、侍奉精神3以上+屈服刻印Lv3+反抗刻印Lv0+侍奉快乐经验200以上+依赖度1000以上+异常经验2未満+助手调教经验が1000未満
	IF ABL:0 >= 3 && ABL:7 >= 3 && MARK:2 == 3 && MARK:3 == 0 && EXP:21 >= 200 && CFLAG:2 >= 1000 && EXP:50 < 2 && A < 1000
		PRINTFORMW %CALLNAME:TARGET%看向这边的眼神有些奇怪
		PRINTFORML 最近%CALLNAME:TARGET%似乎对%PLAYER_NAME(1)%的一举一动非常关心，相处时也总是很开心的样子
		PRINTFORMW ★%NAME:TARGET%取得了【恋慕】素质
		PRINTL
		PRINTFORML 调教的成果出来了，%CALLNAME:TARGET%几乎不再反抗了，
		PRINTFORMW 于是%PLAYER_NAME(1)%放宽了对%CALLNAME:TARGET%的行动限制
		PRINTFORMW ★%NAME:TARGET%在休息时间可以自由地在房子里走来走去了
		PRINTL
		TALENT:3 = 1
		FLAG:30 += 1

		CALL RELATION_CHECK
	ENDIF

	;淫乱：欲望3以上+CVAB感覚合計10以上+快乐刻印Lv3+屈服刻印Lv3+反抗刻印Lv0+绝顶经验50以上+异常经验3以上or异常经验1以上+助手调教经验1000以上or助手调教经验2000以上
	IF ABL:1 >= 3 && ABL:3+ABL:4+ABL:5+ABL:6 >= 10 && MARK:1 == 3 && MARK:2 == 3 && MARK:3 == 0 && EXP:2 >= 50
		IF EXP:50 >= 3 || (EXP:50 >= 1 && A >= 1000) || A >= 2000
			PRINTFORMW %CALLNAME:TARGET%看向这边的眼神有些奇怪
			PRINTFORML 最近%CALLNAME:TARGET%似乎极容易沉溺在%PLAYER_NAME(1)%所给予的快乐中
			PRINTFORMW ★%NAME:TARGET%取得了【淫乱】素质
			PRINTL
			PRINTFORML 调教的成果出来了，%CALLNAME:TARGET%几乎不打算逃跑了，
			PRINTFORMW 于是%PLAYER_NAME(1)%放宽了对%CALLNAME:TARGET%的行动限制
			PRINTFORMW ★%NAME:TARGET%在休息时间可以自由地在房子里走来走去了
			PRINTL
			TALENT:4 = 1
			FLAG:31 += 1
			CALL RELATION_CHECK
		ENDIF
	ENDIF

	;服从：顺从、受虐属性3以上+CAVB感覚10未満+屈服刻印Lv3+反抗刻印Lv0+痛苦快乐经验+紧缚经验200以上+依赖度-1000以下+异常经验2以上+助手调教经验が1000未満
	I = CFLAG:2 * -1
	IF ABL:0 >= 3 && ABL:9 >= 3 && ABL:3+ABL:4+ABL:5+ABL:6 < 10 && MARK:2 == 3 && MARK:3 == 0 && EXP:30+EXP:51 >= 200 && I >= 1000 && EXP:50 >= 2 && A < 1000
		PRINTFORMW %CALLNAME:TARGET%看向这边的眼神有些奇怪
		PRINTFORML 最近%CALLNAME:TARGET%在%PLAYER_NAME(1)%面前极为顺服
		PRINTFORMW ★%NAME:TARGET%取得了【服从】素质
		PRINTL
		PRINTFORML 调教的成果出来了，%CALLNAME:TARGET%几乎不打算逃跑了，
		PRINTFORMW 于是%PLAYER_NAME(1)%放宽了对%CALLNAME:TARGET%的行动限制
		PRINTFORMW ★%NAME:TARGET%在休息时间可以自由地在房子里走来走去了
		PRINTL
		TALENT:5 = 1
		FLAG:32 += 1

		CALL RELATION_CHECK
	ENDIF

ENDIF


IF TALENT:6 == 0 && TALENT:7 == 0 && TALENT:8 == 0 && TALENT:9 == 0
	;被调教经验の合計からマスター调教の经验を引いて助手调教经验を算出
	A = 0
	REPEAT CHARANUM
		B = NO:COUNT + 1199
		A += CFLAG:B
	REND
	M = NO:MASTER + 1199
	A -= CFLAG:M


	;相亲相爱:恋慕、顺从、侍奉精神5以上+反抗刻印Lv0+爱情经验200以上+侍奉快乐经验400以上+依赖度3000以上+异常经验5未満+助手调教经验が1500未満
	IF TALENT:3 && ABL:0 >= 5 && ABL:7 >= 5 && MARK:3 == 0 && EXP:23 >= 200 && EXP:21 >= 400 && CFLAG:2 >= 3000 && EXP:50 < 5 && A < 1500
		PRINTFORMW %CALLNAME:TARGET%看向这边的眼神很奇怪
		PRINTFORML 最近%CALLNAME:TARGET%似乎身心都很依赖%PLAYER_NAME(1)%的样子
		PRINTFORMW ★%NAME:TARGET%的【恋慕】转变为【相亲相爱】了
		TALENT:3 = 0
		TALENT:6 = 1
		PRINTL 　
	ENDIF
	;娼妇：淫乱、欲望5以上+CVAB感覚合計20以上+反抗刻印Lv0+绝顶经验200以上+异常经验6以上or异常经验4以上+助手调教经验2000以上or异常经验3以上+助手调教经验3000以上
	IF TALENT:4 && ABL:1 >= 5 && ABL:3+ABL:4+ABL:5+ABL:6 >= 20 && MARK:3 == 0 && EXP:2 >= 200
		IF EXP:50 >= 6 || (EXP:50 >= 4 && A >= 2000) || (EXP:50 >= 3 && A >= 3000)
			PRINTFORMW %CALLNAME:TARGET%看向这边的眼神很奇怪
			PRINTFORML 最近%CALLNAME:TARGET%似乎身心都沉溺于%PLAYER_NAME(1)%所给予的快乐当中
			;男なら「娼夫」
			IF MALE(TARGET)
				PRINTFORMW ★%NAME:TARGET%的【淫乱】转变为【娼夫】了
			ELSE
				PRINTFORMW ★%NAME:TARGET%的【淫乱】转变为【娼妇】了
			ENDIF
			PRINTL 　
			TALENT:4 = 0
			TALENT:7 = 1
		ENDIF
	ENDIF

	;隶属：服从、顺从、受虐属性5以上+CAVB感覚15未満+反抗刻印Lv0+痛苦快乐经验+紧缚经验500以上+依赖度-3000以下+异常经验5以上+助手调教经验が1500未満
	I = CFLAG:2 * -1
	IF TALENT:5 && ABL:0 >= 5 && ABL:9 >= 5 && ABL:3+ABL:4+ABL:5+ABL:6 < 15 && MARK:3 == 0 && EXP:30+EXP:51 >= 500 && I >= 3000 && EXP:50 >= 5 && A < 1500
		PRINTFORMW %CALLNAME:TARGET%看向这边的眼神很奇怪
		PRINTFORML 最近%CALLNAME:TARGET%似乎身心都臣服在%PLAYER_NAME(1)%的足下了
		PRINTFORMW ★%NAME:TARGET%的【服从】转变为【隶属】了
		PRINTL 　
		TALENT:5 = 0
		TALENT:8 = 1
	ENDIF

ENDIF

;---------------------------------------------------------
;其他奴隶の素質および能力
;---------------------------------------------------------
;特殊性感素質、一つしか取得はできない（重複した場合は上から優先）
;性成瘾４以上、性交经验２００以上、绝顶经验１５０以上
IF ABL:18 >= 4 && EXP:4 >= 200 && EXP:2 >= 150 && TALENT:74 == 0 && TALENT:75 == 0 && TALENT:76 == 0 && TALENT:77 == 0 && TALENT:78 == 0
	TFLAG:13 = 55
	CALL KOJO_MESSAGE_EVENT
	PRINTFORMW %NAME:TARGET%取得了【性爱狂】素质
	PRINTL 　
	TALENT:性爱狂 = 1
ENDIF
;自慰狂：Ｃ感觉４以上、调教自慰经验１００以上、绝顶经验１５０以上
IF ABL:3 >= 4 && EXP:11 >= 100 && EXP:2 >= 150 && TALENT:74 == 0 && TALENT:75 == 0 && TALENT:76 == 0 && TALENT:77 == 0 && TALENT:78 == 0
	TFLAG:13 = 56
	CALL KOJO_MESSAGE_EVENT
	PRINTFORMW %NAME:TARGET%取得了【自慰狂】素质
	PRINTL 　
	TALENT:自慰狂 = 1
ENDIF

;淫壶：Ｖ感觉４以上、Ｖ经验２００以上、绝顶经验１５０以上
IF ABL:4 >= 4 && EXP:0 >= 200 && EXP:2 >= 150 && TALENT:74 == 0 && TALENT:75 == 0 && TALENT:76 == 0 && TALENT:77 == 0 && TALENT:78 == 0
	TFLAG:13 = 57
	CALL KOJO_MESSAGE_EVENT
	PRINTFORMW %NAME:TARGET%取得了【淫壶】素质
	PRINTL 　
	TALENT:淫壶 = 1
ENDIF

;尻穴狂：Ａ感觉４以上、Ａ经验３００以上、绝顶经验１５０以上
IF ABL:5 >= 4 && EXP:1 >= 300 && EXP:2 >= 150 && TALENT:74 == 0 && TALENT:75 == 0 && TALENT:76 == 0 && TALENT:77 == 0 && TALENT:78 == 0
	TFLAG:13 = 58
	CALL KOJO_MESSAGE_EVENT
	PRINTFORMW %NAME:TARGET%取得了【尻穴狂】素质
	PRINTL 　
	TALENT:尻穴狂 = 1
ENDIF

;淫乳：Ｂ感觉４以上、喷乳经验１００以上、绝顶经验１５０以上
IF ABL:6 >= 4 && EXP:54 >= 100 && EXP:2 >= 150 && TALENT:74 == 0 && TALENT:75 == 0 && TALENT:76 == 0 && TALENT:77 == 0 && TALENT:78 == 0
	TFLAG:13 = 59
	CALL KOJO_MESSAGE_EVENT
	PRINTFORMW %NAME:TARGET%取得了【淫乳】素质
	PRINTL 　
	TALENT:淫乳 = 1
ENDIF


;特殊性癖素質
;施虐狂：嗜虐属性Lv４以上、嗜虐快乐经验３００以上、技巧Lv４以上
IF ABL:10 >= 4 && EXP:32 >= 300 && ABL:2 >= 4 && TALENT:83 == 0 && TALENT:84 == 0
	TFLAG:13 = 61
	CALL KOJO_MESSAGE_EVENT
	PRINTFORMW %NAME:TARGET%取得了【施虐狂】素质
	PRINTL 　
	TALENT:施虐狂 = 1
ENDIF

;受虐狂：受虐属性Lv４以上、痛苦快乐经验３００以上
IF ABL:9 >= 4 && EXP:30 >= 300 && TALENT:83 == 0 && TALENT:84 == 0
	TFLAG:13 = 62
	CALL KOJO_MESSAGE_EVENT
	PRINTFORMW %NAME:TARGET%取得了【受虐狂】素质
	PRINTL 　
	TALENT:受虐狂 = 1
ENDIF
;绝伦：射精经验が400以上、且つ男である時に取得
IF EXP:3 >= 400 && TALENT:152 == 0 && TALENT:140 == 1
	PRINTFORMW %CALLNAME%取得了【绝伦】素质
	TALENT:152 = 1
ENDIF

;「嫉妒」状態＋「情绪不安定」の奴隶が疯癫になるかどうかをチェック
REPEAT CHARANUM
	;恋慕は8回以上で発動　　相亲相爱+嫉妒心は　5回以上で発動可能、育児部屋にいない
	IF TALENT:COUNT:情绪不安定 && TALENT:COUNT:嫉妒 && !TALENT:COUNT:疯癫 && !((TALENT:COUNT:怀孕 && CFLAG:COUNT:110 - 3 <= DAY) || TALENT:COUNT:育儿中) && COUNT != TARGET && COUNT != ASSI && NO:COUNT != PREVCOM:801 && NO:COUNT != PREVCOM:802 && CFLAG:COUNT:(2000+ NO:TARGET) != 7
		;これまで调教されてない回数
		LOCAL = 0
		FOR COUNT:1, 0,14
			SIF PREVCOM:(COUNT:1 +801) != NO:COUNT && NO2(PREVCOM:(COUNT:1 +801)) > 0 && CFLAG:COUNT:(2000+ PREVCOM:(COUNT:1 +801)) != 7
				LOCAL += 1
		NEXT
		IF LOCAL < 5
		ELSEIF TALENT:COUNT:嫉妒心 && TALENT:COUNT:相亲相爱
			IF RAND:18 <= LOCAL
			    PRINTL
				PRINTFORMW 因嫉妒而发狂的%CALLNAME:COUNT%似乎病倒了
				PRINTFORMW %NAME:COUNT%【疯癫】了
				TALENT:COUNT:疯癫 = 1
				IF (FLAG:2 & 6) == 6 && CHARANUM > 1 && TARGET > 0
				    PRINTFORMW %NAME:COUNT%获得了【病娇】称号
                    TALENT:COUNT:947 = 1
                ENDIF
			ENDIF
		ELSEIF LOCAL >= 8
			IF RAND:24 <= LOCAL
			    PRINTL
				PRINTFORMW 因嫉妒而发狂的%CALLNAME:COUNT%似乎病倒了
				PRINTFORMW %NAME:COUNT%【疯癫】了
				TALENT:COUNT:疯癫 = 1
				IF (FLAG:2 & 6) == 6 && CHARANUM > 1 && TARGET > 0
				    PRINTFORMW %NAME:COUNT%获得了【病娇】称号
                    TALENT:COUNT:947 = 1
                ENDIF
			ENDIF
		ENDIF
	ENDIF
REND
CALL 嫉妒觸發1
@嫉妒觸發1
IF 嫉妒開關 == 1
	RETURN 0
ELSEIF 嫉妒開關 == 2
	SIF RAND:2
		RETURN 0
ENDIF
;嫉妒心持ちのほかの奴隶が「嫉妒」を持つかどうかチェック
REPEAT CHARANUM
	;恋慕は6回以上で発動　　相亲相爱+嫉妒心は　3回以上で発動可能、育児部屋にいない
	IF !TALENT:COUNT:嫉妒 && (TALENT:COUNT:嫉妒心 || TALENT:COUNT:相亲相爱) && KANRAKU(COUNT) == 1 && !((TALENT:COUNT:怀孕 && CFLAG:COUNT:110 - 3 <= DAY) || TALENT:COUNT:育儿中) && COUNT != TARGET && COUNT != ASSI && NO:COUNT != PREVCOM:801 && NO:COUNT != PREVCOM:802 && CFLAG:COUNT:(2000+ NO:TARGET) != 7
		;これまで调教されてない回数
		LOCAL = 0
		FOR COUNT:1, 0,14
			SIF PREVCOM:(COUNT:1 +801) != NO:COUNT && NO2(PREVCOM:(COUNT:1 +801)) > 0 && CFLAG:COUNT:(2000+ PREVCOM:(COUNT:1 +801)) != 7
				LOCAL += 1
		NEXT
		IF LOCAL < 3
		ELSEIF TALENT:COUNT:嫉妒心 && TALENT:COUNT:相亲相爱
			SIF LOCAL > 8
				LOCAL = 8
			IF RAND:10 <= LOCAL
			    PRINTL
				PRINTFORMW %CALLNAME:COUNT%似乎对不止调教自己一人的%PLAYER_NAME(1)%抱有不满
				PRINTFORMW %NAME:COUNT%进入了【嫉妒】状态
				TALENT:COUNT:嫉妒 = 1
			ENDIF
		ELSEIF LOCAL >= 6
			IF RAND:20 <= LOCAL
			    PRINTL
				PRINTFORMW %CALLNAME:COUNT%似乎对不止调教自己一人的%PLAYER_NAME(1)%抱有不满
				PRINTFORMW %NAME:COUNT%进入了【嫉妒】状态
				TALENT:COUNT:嫉妒 = 1
			ENDIF
		ENDIF
		IF TALENT:COUNT:嫉妒
		    PRINTL
			PRINTFORMW %CALLNAME:COUNT%和%CALLNAME:TARGET%的关系恶化了
			RELATION:COUNT:(NO:TARGET) /= 3
			RELATION:COUNT:(NO:TARGET) *= 2
			RELATION:TARGET:(NO:COUNT) /= 4
			RELATION:TARGET:(NO:COUNT) *= 3
			FOR COUNT:1, 0,14
				LOCAL = PREVCOM:(COUNT:1 + 801)
				LOCAL:1 = NO2(LOCAL)
				IF LOCAL != NO:COUNT && LOCAL > 0 && LOCAL:1 > 0 && LOCAL != NO:TARGET && CFLAG:COUNT:(2000+ LOCAL) != 7
					PRINTFORMW %CALLNAME:COUNT%和%CALLNAME:(LOCAL:1)%的关系恶化了
					RELATION:COUNT:(NO:(LOCAL:1)) /= 3
					RELATION:COUNT:(NO:(LOCAL:1)) *= 2
					RELATION:(LOCAL:1):(NO:COUNT) /= 4
					RELATION:(LOCAL:1):(NO:COUNT) *= 3
					BREAK
				ENDIF
			NEXT
		ENDIF
	ENDIF
REND

;---------------------------------------------------------
;主人の素質および能力
;---------------------------------------------------------
@EVENTCHECK_M
;主人の技巧：调教经验が20、100、250、400、600のたびに上昇、Lv５まで
IF EXP:MASTER:70 >= 600 && ABL:MASTER:2 <= 4
	ABL:MASTER:2 = 5
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
	PRINTL 　
ELSEIF EXP:MASTER:70 >= 400 && ABL:MASTER:2 <= 3
	ABL:MASTER:2 = 4
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
	PRINTL 　
ELSEIF EXP:MASTER:70 >= 250 && ABL:MASTER:2 <= 2
	ABL:MASTER:2 = 3
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
	PRINTL 　
ELSEIF EXP:MASTER:70 >= 100 && ABL:MASTER:2 <= 1
	ABL:MASTER:2 = 2
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
	PRINTL 　
ELSEIF EXP:MASTER:70 >= 20 && ABL:MASTER:2 <= 0
	ABL:MASTER:2 = 1
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
	PRINTL 　
ENDIF
;素質：学得快、手指灵巧、谜之魅力、禁断的知识のいずれかがあるときLv１０まで
;调教经验が、1000、1500、2000、3000、5000のたびに上昇
IF TALENT:MASTER:50 || TALENT:MASTER:58 || TALENT:MASTER:94 || TALENT:MASTER:144
	IF EXP:MASTER:70 >= 5000 && ABL:MASTER:2 <= 9
		ABL:MASTER:2 = 10
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
		PRINTL 　
	ELSEIF EXP:MASTER:70 >= 3000 && ABL:MASTER:2 <= 8
		ABL:MASTER:2 = 9
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
		PRINTL 　
	ELSEIF EXP:MASTER:70 >= 2000 && ABL:MASTER:2 <= 7
		ABL:MASTER:2 = 8
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
		PRINTL 　
	ELSEIF EXP:MASTER:70 >= 1500 && ABL:MASTER:2 <= 6
		ABL:MASTER:2 = 7
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
		PRINTL 　
	ELSEIF EXP:MASTER:70 >= 1000 && ABL:MASTER:2 <= 5
		ABL:MASTER:2 = 6
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:2%升到{ABL:MASTER:2}了
		PRINTL 　
	ENDIF
ENDIF

;主人の嗜虐属性：嗜虐快乐经验が10、20、50、100、200のたびに上昇、Lv５まで
IF EXP:MASTER:32 >= 200 && ABL:MASTER:10 <= 4
	ABL:MASTER:10 = 5
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
	PRINTL 　
ELSEIF EXP:MASTER:32 >= 100 && ABL:MASTER:10 <= 3
	ABL:MASTER:10 = 4
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
	PRINTL 　
ELSEIF EXP:MASTER:32 >= 50 && ABL:MASTER:10 <= 2
	ABL:MASTER:10 = 3
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
	PRINTL 　
ELSEIF EXP:MASTER:32 >= 20 && ABL:MASTER:10 <= 1
	ABL:MASTER:10 = 2
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
	PRINTL 　
ELSEIF EXP:MASTER:32 >= 10 && ABL:MASTER:10 <= 0
	ABL:MASTER:10 = 1
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
	PRINTL 　
ENDIF
;【施虐狂】があるとき、Lv１０まで、嗜虐快乐经验300、500、700、1000、2000で上昇
IF TALENT:MASTER:83
	IF EXP:MASTER:32 >= 2000 && ABL:MASTER:10 <= 9
		ABL:MASTER:10 = 10
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
		PRINTL 　
	ELSEIF EXP:MASTER:32 >= 1000 && ABL:MASTER:10 <= 8
		ABL:MASTER:10 = 9
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
		PRINTL 　
	ELSEIF EXP:MASTER:32 >= 700 && ABL:MASTER:10 <= 7
		ABL:MASTER:10 = 8
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
		PRINTL 　
	ELSEIF EXP:MASTER:32 >= 500 && ABL:MASTER:10 <= 6
		ABL:MASTER:10 = 7
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
		PRINTL 　
	ELSEIF EXP:MASTER:32 >= 300 && ABL:MASTER:10 <= 5
		ABL:MASTER:10 = 6
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:10%升到{ABL:MASTER:10}了
		PRINTL 　
	ENDIF
ENDIF

;主人の受虐属性：痛苦快乐经验が10、20、50、100、200のたびに上昇、Lv５まで
IF EXP:MASTER:30 >= 200 && ABL:MASTER:9 <= 4
	ABL:MASTER:9 = 5
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
	PRINTL 　
ELSEIF EXP:MASTER:30 >= 100 && ABL:MASTER:9 <= 3
	ABL:MASTER:9 = 4
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
	PRINTL 　
ELSEIF EXP:MASTER:30 >= 50 && ABL:MASTER:9 <= 2
	ABL:MASTER:9 = 3
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
	PRINTL 　
ELSEIF EXP:MASTER:30 >= 20 && ABL:MASTER:9 <= 1
	ABL:MASTER:9 = 2
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
	PRINTL 　
ELSEIF EXP:MASTER:30 >= 10 && ABL:MASTER:9 <= 0
	ABL:MASTER:9 = 1
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
	PRINTL 　
ENDIF
;【受虐狂】があるとき、Lv１０まで、痛苦快乐经验300、500、700、1000、2000で上昇
IF TALENT:MASTER:84
	IF EXP:MASTER:30 >= 2000 && ABL:MASTER:9 <= 9
		ABL:MASTER:9 = 10
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
		PRINTL 　
	ELSEIF EXP:MASTER:30 >= 1000 && ABL:MASTER:9 <= 8
		ABL:MASTER:9 = 9
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
		PRINTL 　
	ELSEIF EXP:MASTER:30 >= 700 && ABL:MASTER:9 <= 7
		ABL:MASTER:9 = 8
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
		PRINTL 　
	ELSEIF EXP:MASTER:30 >= 500 && ABL:MASTER:9 <= 6
		ABL:MASTER:9 = 7
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
		PRINTL 　
	ELSEIF EXP:MASTER:30 >= 300 && ABL:MASTER:9 <= 5
		ABL:MASTER:9 = 6
		PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:9%升到{ABL:MASTER:9}了
		PRINTL 　
	ENDIF
ENDIF

;主人の摄影技能：摄影经验が10、30、60、100、150のたびに上昇、Lv５まで
IF EXP:MASTER:62 >= 150 && ABL:MASTER:13 <= 4
	ABL:MASTER:13 = 5
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:13%升到{ABL:MASTER:13}了
	PRINTL 　
ELSEIF EXP:MASTER:62 >= 100 && ABL:MASTER:13 <= 3
	ABL:MASTER:13 = 4
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:13%升到{ABL:MASTER:13}了
	PRINTL 　
ELSEIF EXP:MASTER:62 >= 60 && ABL:MASTER:13 <= 2
	ABL:MASTER:13 = 3
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:13%升到{ABL:MASTER:13}了
	PRINTL 　
ELSEIF EXP:MASTER:62 >= 30 && ABL:MASTER:13 <= 1
	ABL:MASTER:13 = 2
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:13%升到{ABL:MASTER:13}了
	PRINTL 　
ELSEIF EXP:MASTER:62 >= 10 && ABL:MASTER:13 <= 0
	ABL:MASTER:13 = 1
	PRINTFORMW %CALLNAME:PLAYER%的%ABLNAME:13%升到{ABL:MASTER:13}了
	PRINTL 　
ENDIF
;主人の绝伦：调教者の射精经验が300以上、且つ男である時に取得
IF EXP:MASTER:3 >= 300 && TALENT:MASTER:152 == 0 && TALENT:MASTER:140 == 1
	PRINTFORMW %CALLNAME:MASTER%掌握了【绝伦】
	TALENT:MASTER:152 = 1
ENDIF

;主人の谜之魅力：恋慕･服从にした奴隶の数が5人以上
B = 0
	B = FLAG:30 + FLAG:32
IF B >= 5 && TALENT:MASTER:94 == 0
	PRINTFORMW %CALLNAME:PLAYER%掌握了【谜之魅力】
	TALENT:MASTER:94 = 1
ENDIF

;手指灵巧：技巧５以上、陷落ルート各一人以上いること(8 着衣プ雷拡張オン)
IF FLAG:2 & 8
	B = 0
	C = 0
	D = 0
	B = FLAG:30
	C = FLAG:32
	D = FLAG:31
	IF ABL:MASTER:2 >= 5 && B && C && D && TALENT:MASTER:58 == 0
		PRINTFORMW %CALLNAME:MASTER%掌握了【手指灵巧】
		TALENT:MASTER:58 = 1
	ENDIF
ENDIF

;禁断的知识：陷落ルート各一人以上、调教经验2000以上
IF TALENT:MASTER:禁断的知识 == 0
	B = 0
	C = 0
	D = 0
	B = FLAG:30
	C = FLAG:32
	D = FLAG:31
	IF EXP:MASTER:70 >= 2000 && B && C && D
		PRINTFORMW %CALLNAME:MASTER%掌握了【禁断的知识】
		TALENT:MASTER:禁断的知识 = 1
	ENDIF
ENDIF
;调和知识：淫乱･服从にした奴隶の数が5人以上、调教经验2000以上
IF TALENT:MASTER:调和知识 == 0
	B = 0
	B = FLAG:31 + FLAG:32
	IF EXP:MASTER:调教经验 >= 2000 && B >= 5
		PRINTFORMW %CALLNAME:MASTER%掌握了【调和知识】
		TALENT:MASTER:调和知识 = 1
	ENDIF
ENDIF

;主人の施虐狂：嗜虐属性がLv４以上、嗜虐快乐经验300以上で施虐狂
IF ABL:MASTER:10 >= 4 && EXP:MASTER:32 >= 300 && TALENT:MASTER:83 == 0 && TALENT:MASTER:84 == 0
	PRINTFORMW %CALLNAME:PLAYER%变成【施虐狂】了
	TALENT:MASTER:83 = 1
ENDIF

;主人の受虐狂：受虐属性がLv４以上、痛苦快乐经验300以上で受虐狂
IF ABL:MASTER:9 >= 4 && EXP:MASTER:30 >= 300 && TALENT:MASTER:83 == 0 && TALENT:MASTER:84 == 0
	PRINTFORMW %CALLNAME:PLAYER%变成【受虐狂】了
	TALENT:MASTER:84 = 1
ENDIF

;---------------------------------------------------------
;助手の素質および能力
;---------------------------------------------------------
@EVENTCHECK_A
;助手の技巧：调教经验が20、100、250、400、600のたびに上昇、Lv５まで
IF EXP:ASSI:70 >= 600 && ABL:ASSI:2 <= 4
	ABL:ASSI:2 = 5
	PRINTFORMW %NAME:ASSI%的%ABLNAME:2%升到{ABL:ASSI:2}了
	PRINTL 　
ELSEIF EXP:ASSI:70 >= 400 && ABL:ASSI:2 <= 3
	ABL:ASSI:2 = 4
	PRINTFORMW %NAME:ASSI%的%ABLNAME:2%升到{ABL:ASSI:2}了
	PRINTL 　
ELSEIF EXP:ASSI:70 >= 250 && ABL:ASSI:2 <= 2
	ABL:ASSI:2 = 3
	PRINTFORMW %NAME:ASSI%的%ABLNAME:2%升到{ABL:ASSI:2}了
	PRINTL 　
ELSEIF EXP:ASSI:70 >= 100 && ABL:ASSI:2 <= 1
	ABL:ASSI:2 = 2
	PRINTFORMW %NAME:ASSI%的%ABLNAME:2%升到{ABL:ASSI:2}了
	PRINTL 　
ELSEIF EXP:ASSI:70 >= 20 && ABL:ASSI:2 <= 0
	ABL:ASSI:2 = 1
	PRINTFORMW %NAME:ASSI%的%ABLNAME:2%升到{ABL:ASSI:2}了
	PRINTL 　
ENDIF

;助手の嗜虐属性：嗜虐快乐经验が10、20、50、100、200のたびに上昇、Lv５まで
IF EXP:ASSI:32 >= 200 && ABL:ASSI:10 <= 4
	ABL:ASSI:10 = 5
	PRINTFORMW %NAME:ASSI%的%ABLNAME:10%升到{ABL:ASSI:10}了
	PRINTL 　
ELSEIF EXP:ASSI:32 >= 100 && ABL:ASSI:10 <= 3
	ABL:ASSI:10 = 4
	PRINTFORMW %NAME:ASSI%的%ABLNAME:10%升到{ABL:ASSI:10}了
	PRINTL 　
ELSEIF EXP:ASSI:32 >= 50 && ABL:ASSI:10 <= 2
	ABL:ASSI:10 = 3
	PRINTFORMW %NAME:ASSI%的%ABLNAME:10%升到{ABL:ASSI:10}了
	PRINTL 　
ELSEIF EXP:ASSI:32 >= 20 && ABL:ASSI:10 <= 1
	ABL:ASSI:10 = 2
	PRINTFORMW %NAME:ASSI%的%ABLNAME:10%升到{ABL:ASSI:10}了
	PRINTL 　
ELSEIF EXP:ASSI:32 >= 10 && ABL:ASSI:10 <= 0
	ABL:ASSI:10 = 1
	PRINTFORMW %NAME:ASSI%的%ABLNAME:10%升到{ABL:ASSI:10}了
	PRINTL 　
ENDIF

;助手の受虐属性：痛苦快乐经验が10、20、50、100、200のたびに上昇、Lv５まで
IF EXP:ASSI:30 >= 200 && ABL:ASSI:9 <= 4
	ABL:ASSI:9 = 5
	PRINTFORMW %NAME:ASSI%的%ABLNAME:9%升到{ABL:ASSI:9}了
	PRINTL 　
ELSEIF EXP:ASSI:30 >= 100 && ABL:ASSI:9 <= 3
	ABL:ASSI:9 = 4
	PRINTFORMW %NAME:ASSI%的%ABLNAME:9%升到{ABL:ASSI:9}了
	PRINTL 　
ELSEIF EXP:ASSI:30 >= 50 && ABL:ASSI:9 <= 2
	ABL:ASSI:9 = 3
	PRINTFORMW %NAME:ASSI%的%ABLNAME:9%升到{ABL:ASSI:9}了
	PRINTL 　
ELSEIF EXP:ASSI:30 >= 20 && ABL:ASSI:9 <= 1
	ABL:ASSI:9 = 2
	PRINTFORMW %NAME:ASSI%的%ABLNAME:9%升到{ABL:ASSI:9}了
	PRINTL 　
ELSEIF EXP:ASSI:30 >= 10 && ABL:ASSI:9 <= 0
	ABL:ASSI:9 = 1
	PRINTFORMW %NAME:ASSI%的%ABLNAME:9%升到{ABL:ASSI:9}了
	PRINTL 　
ENDIF

;助手の摄影技能：摄影经验が10、30、60、100、150のたびに上昇、Lv５まで
IF EXP:ASSI:62 >= 150 && ABL:ASSI:13 <= 4
	ABL:ASSI:13 = 5
	PRINTFORMW %NAME:ASSI%的%ABLNAME:13%升到{ABL:ASSI:13}了
	PRINTL 　
ELSEIF EXP:ASSI:62 >= 100 && ABL:ASSI:13 <= 3
	ABL:ASSI:13 = 4
	PRINTFORMW %NAME:ASSI%的%ABLNAME:13%升到{ABL:ASSI:13}了
	PRINTL 　
ELSEIF EXP:ASSI:62 >= 60 && ABL:ASSI:13 <= 2
	ABL:ASSI:13 = 3
	PRINTFORMW %NAME:ASSI%的%ABLNAME:13%升到{ABL:ASSI:13}了
	PRINTL 　
ELSEIF EXP:ASSI:62 >= 30 && ABL:ASSI:13 <= 1
	ABL:ASSI:13 = 2
	PRINTFORMW %NAME:ASSI%的%ABLNAME:13%升到{ABL:ASSI:13}了
	PRINTL 　
ELSEIF EXP:ASSI:62 >= 10 && ABL:ASSI:13 <= 0
	ABL:ASSI:13 = 1
	PRINTFORMW %NAME:ASSI%的%ABLNAME:13%升到{ABL:ASSI:13}了
	PRINTL 　
ENDIF

;助手の施虐狂：嗜虐属性がLv４以上、嗜虐快乐经验300以上で施虐狂
IF ABL:ASSI:10 >= 4 && EXP:ASSI:32 >= 300 && TALENT:ASSI:83 == 0 && TALENT:ASSI:84 == 0
	PRINTFORMW %CALLNAME:ASSI%的样子有些奇怪
	PRINTFORML %CALLNAME:ASSI%似乎觉醒了凌虐他人的嗜好
	PRINTFORMW %NAME:ASSI%变成【施虐狂】了
	TALENT:ASSI:83 = 1
ENDIF

;助手の受虐狂：受虐属性がLv４以上、痛苦快乐经验300以上で受虐狂
IF ABL:ASSI:9 >= 4 && EXP:ASSI:30 >= 300 && TALENT:ASSI:83 == 0 && TALENT:ASSI:84 == 0
	PRINTFORMW %CALLNAME:ASSI%的样子有些奇怪
	PRINTFORML %CALLNAME:ASSI%似乎因身体受到伤害而喜悦兴奋
	PRINTFORMW %NAME:ASSI%变成【受虐狂】了
	PRINTL 　
	TALENT:ASSI:84 = 1
ENDIF
;助手の绝伦：射精经验が400以上、且つ男である時に取得
IF EXP:ASSI:3 >= 400 && TALENT:ASSI:152 == 0 && TALENT:ASSI:140 == 1
	PRINTFORMW %CALLNAME:ASSI%取得了【绝伦】素质
	TALENT:ASSI:152 = 1
ENDIF
;独り立ちできる見習いがいるかどうかを
IF !CFLAG:ASSI:35 && CFLAG:ASSI:1 == 3 && ABL:ASSI:技巧 >= 3 && ABL:ASSI:嗜虐属性 >= 5
	CFLAG:ASSI:35 = 1
	FLAG:28 += 1
	PRINTFORMW %CALLNAME:ASSI%成为兼备技巧和嗜虐属性的独当一面的调教师了
	PRINTFORML 日后%NAME:ASSI%可以作为调教师独立生活了
	PRINTFORMW （※独立出去的见习调教师不会再回来）
ENDIF
CALL 嫉妒觸發2
@嫉妒觸發2
;恋慕陷落の嫉妒心持ちor相亲相爱の奴隶を调教してる場合、男助手が今まで14回内に3回以上付くと、［嫉妒］を持つ可能性がある、助手が自分の息子の時は例外
IF 嫉妒開關 == 1
	RETURN 0
ELSEIF 嫉妒開關 == 2
	SIF RAND:2
		RETURN 0
ENDIF	
IF TARGET >= 0 && (MAXBASE:0 - BASE:0 >= 200) && !TALENT:嫉妒 && (TALENT:嫉妒心 || TALENT:相亲相爱) && CFLAG:ASSI:1 != 3 && KANRAKU(TARGET) == 1 && CFLAG:(2000+ NO:ASSI) != 7
	LOCAL = 0
	REPEAT 14
		SIF PREVCOM:(COUNT+801) == NO:TARGET && PREVCOM:(COUNT+815) > 0 && NO2(PREVCOM:(COUNT+815)) > 0 && CFLAG:(NO2(PREVCOM:(COUNT+815))):1 != 3 && CFLAG:(2000+ PREVCOM:(COUNT+815)) != 7
			LOCAL += 1
	REND
	IF LOCAL >= 3 && RAND:15 <= LOCAL
		PRINTFORMW 看到%PLAYER_NAME(1)%和助手一起过来，%CALLNAME%好像很不高兴
		PRINTFORMW %NAME%进入了【嫉妒】状态
		TALENT:嫉妒 = 1
	ENDIF
	PRINTFORMW %CALLNAME%和%CALLNAME:ASSI%的关系恶化了
	RELATION:TARGET:(NO:ASSI) /= 3
	RELATION:TARGET:(NO:ASSI) *= 2
	RELATION:ASSI:(NO:TARGET) /= 4
	RELATION:ASSI:(NO:TARGET) *= 3
	REPEAT 14
		LOCAL = NO2(PREVCOM:(COUNT+815))
		IF PREVCOM:(COUNT+801) == NO:TARGET && PREVCOM:(COUNT+815) > 0 && LOCAL > 0 && CFLAG:LOCAL:1 != 3 && PREVCOM:(COUNT+815) != NO:ASSI && CFLAG:(2000+ PREVCOM:(COUNT+815)) != 7
			PRINTFORMW %CALLNAME%和%CALLNAME:LOCAL%的关系恶化了
			RELATION:TARGET:(NO:LOCAL) /= 3
			RELATION:TARGET:(NO:LOCAL) *= 2
			RELATION:LOCAL:(NO:TARGET) /= 4
			RELATION:LOCAL:(NO:TARGET) *= 3
			BREAK
		ENDIF
	REND
ENDIF
;助手ごとの百合经验もしくは蔷薇经验判定関数
;CFLAGに格納された数値から最も百合经验もしくは蔷薇经验を多く得た助手による百合经验もしくは蔷薇经验をCに格納する
@DECIDE_RELATION
C = 0
REPEAT CHARANUM
	IF CFLAG:(1199 + NO:COUNT) > C
		C = CFLAG:(1199 + NO:COUNT)
		X = NO:COUNT
	ENDIF
REND

;相性変動チェック
;淫乱で主人以上に絡みが多い助手がいる場合はその助手と、それ以外は主人との相性が良くなるようにしてみた
;マイ茄子が多い程大変なのでご褒美的に数値が反転する（助手の場合のみ、相手の相性も変動するtohoAの仕様を継承）
@RELATION_CHECK
CALL DECIDE_RELATION
;CFLAG:M(＝奴隶对主人の絡み经验M = NO:MASTER + 1199)
IF MASTER != X && C > CFLAG:M && RELATION:X < 100 && (TALENT:淫乱 || TALENT:娼妇)
	Y = RELATION:X
	Z = 200 - Y
	SIF Z == 200
		Z = 120
	RELATION:X = Z
	REPEAT CHARANUM
		SIF NO:COUNT == X
			W = COUNT
	REND
	T = NO:TARGET
	SIF RELATION:W:T < Z
		RELATION:W:T = Z
	IF ASSI > 0
		IF ASSI == W
			PRINTFORMW %CALLNAME:TARGET%向投去%CALLNAME:W%妖艳惑人的视线
		ELSE
			PRINTFORMW %CALLNAME:TARGET%苦闷地念叨着%CALLNAME:W%的名字
		ENDIF
	ELSE
		PRINTFORMW %CALLNAME:TARGET%苦闷地念叨着%CALLNAME:W%的名字
	ENDIF
	PRINTFORMW %CALLNAME:TARGET%和%CALLNAME:W%的相性上升了
ELSE
	X = NO:MASTER
	SIF RELATION:X == 0 || RELATION:X > 100
		RETURN 0
	RELATION:X = 200 - RELATION:X
	;PRINTFORMW %CALLNAME:TARGET%对%CALLNAME:MASTER%的相性提高了
ENDIF


