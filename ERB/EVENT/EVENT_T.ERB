;EVENT_T.ERB、EVENT_TRAIN、调教時及び调教前後のイベント
@EVENTTRAIN
#PRI
;主人公の射精を0に
BASE:MASTER:2 = 0
;いちおう调教对象と助手も
BASE:TARGET:2 = 0
SIF ASSI >= 0
	BASE:ASSI:2 = 0
BASE:TARGET:3 = 0
BASE:MASTER:4 = 0
;助手の射精MAXを10000に设定（女助手の時の不具合防止）
SIF ASSI >= 0
	MAXBASE:ASSI:2 = 10000

;今回の指令実行回数を初期化
REPEAT 201
	T:(COUNT+300) = 0
REND

;射精限界数の確保
REPEAT CHARANUM
	IF COUNT == MASTER
		CFLAG:COUNT:11 = 10
		SIF TALENT:COUNT:152 == 1 || TALENT:COUNT:117 == 1
			CFLAG:COUNT:11 += 5
	ELSEIF COUNT == ASSI
		CFLAG:COUNT:11 = 10
	ELSEIF COUNT == TARGET
		CFLAG:COUNT:11 = 10
	ENDIF
REND

;射精フラグ、处女喪失フラグなどを重置
REPEAT 200
	TFLAG:COUNT = 0
REND

;膣内にヴァギナ汚れを付加
SIF TALENT:140 == 0
	STAIN:6 |= 1
SIF TALENT:MASTER:140 == 0
	STAIN:MASTER:6 |= 1
IF ASSI >= 0
	SIF TALENT:ASSI:140 == 0
		STAIN:ASSI:6 |= 1
ENDIF

;避孕套自動装着设定の重置
FLAG:98 = 0

;避孕套射精フラグを重置
CFLAG:107 = 0

;调教者は誰か
IF ASSIPLAY == 0
	PLAYER = MASTER
ELSE
	PLAYER = ASSI
ENDIF

@EVENTTURNEND
#PRI
;拍卖や助手化が可能になったか
SIF TARGET < 0
	RETURN 0
SIF ABL:0+ABL:1 < 6
	RETURN 0
SIF ABL:0 < 4 && ((TALENT:11 && TALENT:5 == 0 && TALENT:8 == 0) || TALENT:12)
	RETURN 0
SIF ABL:1 < 4 && (TALENT:20 || TALENT:32 || TALENT:34)
	RETURN 0

IF ABL:2 >= 3 || ABL:7 >= 3 || ABL:9 >= 3 || ABL:3+ABL:4+ABL:5+ABL:6 >= 8 || ABL:0 >= 5 || ABL:1 >= 5
	IF CFLAG:1 <= 0
		PRINTFORMW %NAME:TARGET%可以作为商品拍卖了
		CFLAG:1 = 1
	ENDIF
ELSE
	RETURN 0
ENDIF

IF (ABL:0+ABL:1+ABL:2+ABL:3+ABL:20 >= 15) || (ABL:0 >= 5 && ABL:1 >= 4)
	IF CFLAG:1 == 1
		PRINTFORMW %NAME:TARGET%可以担任助手了
		CFLAG:1 = 2
	ENDIF
ENDIF

@EVENTTURNEND
IF TARGET >= 0
	;ストレス値の加算
	CFLAG:TARGET:10 += 1
	SIF MARK:3 > 2
		CFLAG:TARGET:10 += 1
	;ストレス値100以上で崩溃を得る
	SIF CFLAG:TARGET:10 >= 100 && TALENT:崩溃 == 0
		CALL COLLAPSE_MIND_TRAIN
	IF CFLAG:TARGET:10 >= 60 && TALENT:崩溃 == 0
		PRINTL
		IF CFLAG:TARGET:10 >= 90
			PRINTFORML %CALLNAME:TARGET%快要被压力压垮了…
			SETCOLOR 255, 0, 0
			PRINTFORM ※%CALLNAME:TARGET%已达[崩溃]边缘。最好是休息一下…
			RESETCOLOR
		ELSEIF CFLAG:TARGET:10 >= 75
			PRINTFORM %CALLNAME:TARGET%的压力好像太大了…
		ELSE
			PRINTFORM %CALLNAME:TARGET%好像受到了压力太大的影响…
		ENDIF
		PRINTW
		IF CFLAG:TARGET:10 >= 905 && CFLAG:37 < 3
			PRINTW
			CFLAG:37 = 3
		ELSEIF CFLAG:TARGET:10 >= 75 && CFLAG:37 < 2
			PRINTW
			CFLAG:37 = 2
		ELSEIF CFLAG:37 < 1
			CFLAG:37 = 1
			PRINTW
		ELSE
			PRINTL
		ENDIF
	ENDIF
ENDIF

IF ASSI >= 0
	IF TALENT:ASSI:91 && ITEM:41 == 0
		PRINTW 获得了[妖狐]效果的媚药
		ITEM:41 = 1
	ENDIF
ENDIF

REPEAT 100
	SIF ITEM:COUNT < 0
		ITEM:COUNT = 0
REND

RETURN 0

@ASSI_CHANGE
;[狐狸]かつ技巧LV5、Ｃ感觉LV5で处女
IF TALENT:ASSI:90 && (ABL:ASSI:2 >= 5 && ABL:ASSI:3 >= 5 && TALENT:ASSI:0)
	DRAWLINE
	PRINTFORML %NAME:ASSI%成为了[妖狐]
	DRAWLINE
	WAIT
	TALENT:ASSI:90 = 0
	TALENT:ASSI:91 = 1
ENDIF

$INPUT_LOOP
;[不可思议的根]かつＣ感觉LV5、精液成瘾LV3以上
IF TALENT:ASSI:137 == 0 &&  TALENT:ASSI:139 == 0 && TALENT:ASSI:138 && (ABL:ASSI:3 >= 5 && ABL:ASSI:16 >= 3)
	DRAWLINE
	PRINTFORML ……貌似出现了[不可思议的根]的效果
	PRINTFORM 要让%CALLNAME:ASSI%成为[
	IF TALENT:ASSI:140
		PRINT 双性
	ELSE
		PRINT 扶她
	ENDIF
	PRINTL ]吗？
	PRINTL [0] - 是
	PRINTL [1] - 否
	INPUT
	IF RESULT == 0
		C = ASSI
		CALL FUTANARI
	ELSEIF RESULT == 1
		PRINTFORML %NAME:ASSI%失去了[不可思议的根]
		TALENT:ASSI:138 = 0
	ELSE
		GOTO INPUT_LOOP_2
	ENDIF
	DRAWLINE
	WAIT
ENDIF

$INPUT_LOOP_2
;[具现化]かつ欲望LV5か百合属性or同性倾向LV4以上
;男性は双性、そうでないときは扶她化
IF TALENT:ASSI:137 == 0 &&  TALENT:ASSI:139 == 0 && TALENT:ASSI:146 && (ABL:ASSI:1 >= 5 || ABL:ASSI:11 >= 4 || ABL:ASSI:20 >= 4)
	DRAWLINE
	PRINTFORML ……貌似出现了[具现化]的效果
	PRINTFORM 要让%CALLNAME:ASSI%成为[
	IF TALENT:ASSI:140
		PRINT 双性
	ELSE
		PRINT 扶她
	ENDIF
	PRINTL ]吗？
	PRINTL [0] - 是
	PRINTL [1] - 否
	INPUT
	IF RESULT == 0
		C = ASSI
		CALL FUTANARI
	ELSEIF RESULT == 1
		PRINTFORML %NAME:ASSI%失去了[具现化]
		TALENT:ASSI:146 = 0
	ELSE
		GOTO INPUT_LOOP_2
	ENDIF
	DRAWLINE
	WAIT
ENDIF

ISASSI:ASSI = 1

RETURN 0


@YOUJI
;调教者が幼稚
IF TALENT:PLAYER:151
	PRINTS NAME:PLAYER
	PRINT 在吮吸母乳的时候
	PRINTS NAME:TARGET
	PRINTW 流出乳汁来了
	TALENT:149 = 1
ENDIF

@EVENTCOMEND

IF EXP:0 == 0 && EXP:1 > 0 && TALENT:30 && CFLAG:100
	CFLAG:100 = 1
	PRINTW 如果能守住贞操的话，用后面做一下也无妨……
ENDIF

;调教で【崩溃】を得た場合のイベント
@COLLAPSE_MIND_TRAIN
PRINTFORMW %CALLNAME:TARGET%的样子很奇怪
PRINTFORMW 由于受到了激烈调教的影响，%CALLNAME:TARGET%的精神似乎变得异常了
PRINTFORMW %NAME:TARGET%【崩溃】了
TALENT:9 = 1
IF TALENT:3 || TALENT:4 || TALENT:5 || TALENT:6 || TALENT:7 || TALENT:8
	PRINTFORM %CALLNAME:TARGET%失去[
	SIF TALENT:3
		PRINTS TALENTNAME:3
	SIF TALENT:4
		PRINTS TALENTNAME:4
	SIF TALENT:5
		PRINTS TALENTNAME:5
	SIF TALENT:6
		PRINTS TALENTNAME:6
	SIF TALENT:7
		PRINTS TALENTNAME:7
	SIF TALENT:8
		PRINTS TALENTNAME:8
	PRINTW ]了
	SIF TALENT:3
		TALENT:3 = 0
	SIF TALENT:4
		TALENT:4 = 0
	SIF TALENT:5
		TALENT:5 = 0
	SIF TALENT:6
		TALENT:6 = 0
	SIF TALENT:7
		TALENT:7 = 0
	SIF TALENT:8
		TALENT:8 = 0
ENDIF


@EVENTEND
#LATER
PRINTL 调教结束了
;結束房間推倒
房間推倒中 = 0
;産卵プ雷の後処理
IF TEQUIP:41 && TEQUIP:42
	CALL DOUBLE_EGGPLAY_OUT
ELSEIF TEQUIP:41
	CALL EGGPLAY_OUT
ELSEIF TEQUIP:42
	CALL KANTYO_EGGPLAY_OUT
ENDIF

;调教後行為のチェック
CALL SELF_CHECK

IF CFLAG:34
	TALENT:包茎 = 1
	IF CFLAG:34 > 9 && !RAND:3
		TALENT:包茎 = 0
		CFLAG:34 = 0
		PRINTL
		PRINTFORMW 被剥了好几次后，%CALLNAME%阴茎的包皮好像无法恢复了
		PRINTFORMW %CALLNAME%失去了【包茎】
		PRINTL
	ENDIF
ENDIF
;搾乳した母乳の拍卖
CALL SELL_MILK

;调教時に録画したビデオを拍卖
CALL SELL_VIDEO

;调教時に摄影した写真を拍卖
CALL SELL_PICTURE

;调教時に減った体力、气力に応じて体力、气力の最大値上昇
CALL EVENT_GROWTH

;何之珠を得られたか
CALL JUEL_CHECK

;否定之珠の打ち消しチェック
CALL DENIAL_CHECK

;今回の指令実行数をCFLAG:300~550（原500）にプラス
REPEAT 251
	CFLAG:(COUNT+300) += T:(COUNT+300)
REND



BEGIN ABLUP

@JUEL_CHECK
REPEAT 25
	IF PALAM:COUNT < PALAMLV:1
		G = 0
	ELSEIF PALAM:COUNT < PALAMLV:1*3
		G = 1
	ELSEIF PALAM:COUNT < PALAMLV:2
		G = 2
	ELSEIF PALAM:COUNT < PALAMLV:2*3
		G = 10
	ELSEIF PALAM:COUNT < PALAMLV:3
		G = 20
	ELSEIF PALAM:COUNT < PALAMLV:3*2
		G = 100
	ELSEIF PALAM:COUNT < PALAMLV:4
		G = 200
	ELSEIF PALAM:COUNT < PALAMLV:5
		G = 1000
	ELSEIF PALAM:COUNT < PALAMLV:6
		G = 2000
	ELSEIF PALAM:COUNT < PALAMLV:7
		G = 3000
	ELSEIF PALAM:COUNT < PALAMLV:8
		G = 5000
	ELSEIF PALAM:COUNT < PALAMLV:9
		G = 8000
	ELSEIF PALAM:COUNT < 1000000
		G = 12000
	ELSEIF PALAM:COUNT < 5000000
		G = 25000
	ELSEIF PALAM:COUNT < 30000000
		G = 40000
	ELSEIF PALAM:COUNT < 100000000
		G = 60000
	ELSE
		G = 100000
	ENDIF

	IF COUNT == 0
		GOTJUEL:COUNT = G + EX:0 * 1000
	ELSEIF COUNT == 1
		GOTJUEL:COUNT = G + EX:1 * 1000
	ELSEIF COUNT == 2
		GOTJUEL:COUNT = G + EX:2 * 1000
	ELSEIF COUNT == 3
		GOTJUEL:COUNT = G + EX:3 * 1000
	ELSEIF COUNT == 22
		GOTJUEL:COUNT = G + EX:22 * 1000
	ELSEIF COUNT == 23
		GOTJUEL:COUNT = G + EX:23 * 1000
	ELSEIF COUNT == 24
		GOTJUEL:COUNT = G + EX:24 * 1000
	ELSEIF COUNT < 12
		GOTJUEL:COUNT = G
	ELSEIF COUNT >= 15 && COUNT <= 21
	    CONTINUE
	ELSE
		GOTJUEL:100 += G
	ENDIF
REND

DRAWLINE
PRINTL 调教的结果：
D = 0
REPEAT 25
	IF COUNT == 0
		D = 0
	ELSEIF COUNT == 1
		D = 1
	ELSEIF COUNT == 2
		D = 2
	ELSEIF COUNT == 3
		D = 3
	ELSEIF COUNT == 4
		D = 4
	ELSEIF COUNT == 5
		D = 5
	ELSEIF COUNT == 6
		D = 6
	ELSEIF COUNT == 7
		D = 7
	ELSEIF COUNT == 8
		D = 8
	ELSEIF COUNT == 9
		D = 9
	ELSEIF COUNT == 10
		D = 10
	ELSEIF COUNT == 11
		D = 11
	ELSEIF COUNT == 12
		D = 12
	ELSEIF COUNT == 13
		D = 13
	ELSEIF COUNT == 14
		D = 14
	ELSEIF COUNT >= 15 && COUNT <= 21
	    CONTINUE
	ELSEIF COUNT == 22
		D = 22
	ELSEIF COUNT == 23
		D = 23
	ELSEIF COUNT == 24
		D = 24
	ENDIF
	
	IF D == 12
		PRINTFORML %PALAMNAME:100%之珠×({JUEL:100}+{GOTJUEL:100})
		JUEL:100 += GOTJUEL:100
	ELSEIF D == 1
		IF TALENT:140
		ELSE
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D}+{GOTJUEL:D})
			JUEL:D += GOTJUEL:D
		ENDIF
	ELSEIF D == 22
		IF TALENT:羽翅 || TALENT:骨翅 || TALENT:蝠翼 || TALENT:虫翼
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D}+{GOTJUEL:D})
			JUEL:D += GOTJUEL:D
		ELSE
		ENDIF
	ELSEIF D == 23
		IF TALENT:兽尾 || TALENT:鱼尾 || TALENT:蛇尾
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D}+{GOTJUEL:D})
			JUEL:D += GOTJUEL:D
		ELSE
		ENDIF
	ELSEIF D == 24
		IF TALENT:兽耳 || TALENT:尖耳
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D}+{GOTJUEL:D})
			JUEL:D += GOTJUEL:D
		ELSE
		ENDIF
	ELSEIF D != 4 && D != 13 && D != 14
		PRINTFORML %PALAMNAME:D%之珠×({JUEL:D}+{GOTJUEL:D})
		JUEL:D += GOTJUEL:D
	ENDIF
	
REND

PRINTW 获得了以上的珠子

@DENIAL_CHECK
SIF JUEL:100 == 0
	RETURN 0

$LABEL_1
A = RAND:3 + 5
B = JUEL:100 / 2
SIF B == 0 && JUEL:100 > 0
	B = 1
SIF JUEL:A < B
	B = JUEL:A
JUEL:A -= B
JUEL:100 -= B

SIF B > 0
	PRINTFORML 失去%PALAMNAME:A%之珠×{B}
SIF JUEL:100 > 0 && (JUEL:5 + JUEL:6 + JUEL:7) > 0
	GOTO LABEL_1

$LABEL_2
A = RAND:3 + 5
B = JUEL:100 / 2
SIF B == 0 && JUEL:100 > 0
	B = 1
SIF JUEL:A < B
	B = JUEL:A
JUEL:A -= B
JUEL:100 -= B
SIF B > 0
	PRINTFORML 失去%PALAMNAME:A%之珠×{B}
SIF JUEL:100 > 0 && (JUEL:5 + JUEL:6 + JUEL:7) > 0
	GOTO LABEL_2

DRAWLINE
PRINTL 否定之珠和其他珠子相互抵消了
PRINTL 结果是……
D = 0
REPEAT 25
	IF COUNT == 0
		D = 0
	ELSEIF COUNT == 1
		D = 1
	ELSEIF COUNT == 2
		D = 2
	ELSEIF COUNT == 3
		D = 3
	ELSEIF COUNT == 4
		D = 4
	ELSEIF COUNT == 5
		D = 5
	ELSEIF COUNT == 6
		D = 6
	ELSEIF COUNT == 7
		D = 7
	ELSEIF COUNT == 8
		D = 8
	ELSEIF COUNT == 9
		D = 9
	ELSEIF COUNT == 10
		D = 10
	ELSEIF COUNT == 11
		D = 11
	ELSEIF COUNT == 12
		D = 12
	ELSEIF COUNT >= 13 && COUNT <= 21
	    CONTINUE
	ELSEIF COUNT == 22
		D = 22
	ELSEIF COUNT == 23
		D = 23
	ELSEIF COUNT == 24
		D = 24
	ENDIF
	

	IF D == 12
		PRINTFORML %PALAMNAME:100%之珠×({JUEL:100})
	ELSEIF D == 1
		IF TALENT:140
		ELSE
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D})
		ENDIF
	ELSEIF D == 22
		IF TALENT:羽翅 || TALENT:骨翅 || TALENT:蝠翼 || TALENT:虫翼
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D})
		ELSE
		ENDIF
	ELSEIF D == 23
		IF TALENT:兽尾 || TALENT:鱼尾 || TALENT:蛇尾
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D})
		ELSE
		ENDIF
	ELSEIF D == 24
		IF TALENT:兽耳 || TALENT:尖耳
			PRINTFORML %PALAMNAME:D%之珠×({JUEL:D})
		ELSE
		ENDIF
	ELSEIF D != 4
		PRINTFORML %PALAMNAME:D%之珠×({JUEL:D})
	ENDIF

REND

PRINTW 变化如上