@逆推PALY
#DIM 攻
#DIM 受

SIF !逆推開關
RETURN 0
;逆推實行可能的情境判定
;助手不可
SIF ASSIPLAY || TEQUIP:44 || TEQUIP:45 || TEQUIP:46 || TEQUIP:47 || TEQUIP:48 || TEQUIP:49
	RETURN 0
;除其他play中不可（新妻除外）
SIF TEQUIP:29 || TEQUIP:30 || TEQUIP:31|| TEQUIP:32 || TEQUIP:50 || TEQUIP:53
	RETURN 0
;触手调教中はダメ
SIF TEQUIP:25
	RETURN 0
;无形体不可
SIF TALENT:无形体
	RETURN 0
;道具装备中不可
SIF TEQUIP:11 || TEQUIP:12 || TEQUIP:13 || TEQUIP:14 || TEQUIP:15 || TEQUIP:16 || TEQUIP:17 || TEQUIP:18 || TEQUIP:19 || TEQUIP:20 || TEQUIP:21 || TEQUIP:22 || TEQUIP:38 || TEQUIP:39 || TEQUIP:37  || TEQUIP:51  || TEQUIP:52
	RETURN 0
;電極使用中は不可
SIF TEQUIP:23 || TEQUIP:24
	RETURN 0
	
;逆推可能计算-------------------------------------------------------------------------------------	
IF TALENT:3 || TALENT:6
	逆推渴望 += RAND:3 + 1
ELSEIF TALENT:4 || TALENT:7
	逆推渴望 += RAND:3 + 2
ELSEIF TALENT:5 || TALENT:8
	逆推渴望 += RAND:3
ENDIF
;媚药加成
SIF TEQUIP:26
	逆推渴望 += RAND:3 + 2
;發情加成
SIF 發情期 == 1
	逆推渴望 += RAND:3
;欲望加成
SIF ABL:3 >= 3
	逆推渴望 += RAND:3
	

	
;逆推實行-----------------------------------------------------------------------------------------------
IF	 !TEQUIP:60 && BASE:1 >= (MAXBASE:1 / 2)
	IF (逆推渴望 >= 60 && 逆推開關 == 2) || (逆推渴望 >= 30 && 逆推開關 == 1)
		PRINTFORML
		PRINTFORML
		CALL 逆推詢問
		$LOOP
		PRINTFORML %CALLNAME%似乎产生想要在上面的渴望……该怎么办呢？
		PRINTFORML
		SETCOLOR 0xFFBFBF
		PRINTBUTTON "  [ 同意逆推 ]", 01
		SETCOLOR 0xADADFF
		PRINTBUTTON "  [ 推開他 ]", 02
		RESETCOLOR
		PRINTL
		INPUT
		IF RESULT == 1
			PRINTFORML
			CALL 指令初始化
			CALL 逆推口上
			逆推同意 = 1
			TEQUIP:60 = 1
			TEQUIP:PLAYER:60 = 1
		ELSEIF RESULT == 2
			CALL 逆推被拒口上
			逆推渴望 -= 1000
		ELSE
			GOTO LOOP 
		ENDIF
	ELSE
		RETURN 0
	ENDIF
ENDIF
;逆推中的自動指令-----------------------------------------------------------------------------------------
IF TEQUIP:60 || TEQUIP:PLAYER:60
		逆推渴望 -= 10
		受 = PLAYER 
		攻 = TARGET
		TARGET = 受
		PLAYER = 攻
		CALL 逆推AUTO
		NPC回合 = 0
		BASE:0 -= (RAND:50 + 50)
		受 = PLAYER 
		攻 = TARGET
		TARGET = 受
		PLAYER = 攻		
	IF BASE:PLAYER:0 <= 0 
		PRINTFORML
		SETCOLOR 0xFF6347
		PRINTFORMW %CALLNAME:PLAYER%的体力已经被%CALLNAME%榨乾了……
		RESETCOLOR
		PRINTFORML
		BASE:PLAYER:0 = 100
		TEQUIP:60 = 0
		TEQUIP:PLAYER:60 = 0
		逆推渴望 = 0
		BEGIN AFTERTRAIN
	ENDIF
ENDIF


@逆推AUTO
DRAWLINE
PRINTFORML
SETCOLOR 0xFFBFBF
PRINTFORMW %CALLNAME:PLAYER%对%CALLNAME%逆推中
PRINTFORML
RESETCOLOR
DRAWLINE
;逆推指令調整
LOCAL:99 = RAND:108
SELECTCASE  LOCAL:99
	CASE 1
		X:99 = 1
		SIF TALENT:140
		X:99 = 2
	CASE 2
		X:99 = 2
		SIF !PENIS(TARGET)
		X:99 = 1
	CASE 3
		X:99 = 3
		SIF TALENT:140	
		X:99 = 13
	CASE 13
		X:99 = 13
		SIF !PENIS(TARGET)
		X:99 = 3
	CASE 6
			X:99 = 7
	CASE 42, 44, 47  
			X:99 = 40
	CASE 43, 45, 46  
			X:99 = 41
	CASE 60
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 211
			SIF TALENT:140
			X:99 = 213
		ELSE
			X:99 = 60
			SIF TALENT:140
			X:99 = 62
		ENDIF
	CASE 61
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 212
			SIF TALENT:140
			X:99 = 214
		ELSE
			X:99 = 61
			SIF TALENT:140
			X:99 = 63
		ENDIF
	CASE 62
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 213
		ELSE
			X:99 = 62
		ENDIF
	CASE 63
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 214
		ELSE
			X:99 = 63
		ENDIF
	CASE 66
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 211
			SIF TALENT:140
			X:99 = 212	
		ELSE
			X:99 = 66
			SIF TALENT:140
			X:99 = 67
		ENDIF
	CASE 67
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 212	
		ELSE
			X:99 = 67
		ENDIF
	CASE 68
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 211
			SIF TALENT:140
			X:99 = 212
		ELSE
			X:99 = 68
			SIF TALENT:140
			X:99 = 70
		ENDIF
	CASE 69
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 211
			SIF TALENT:140
			X:99 = 214
		ELSE
			X:99 = 69
			SIF TALENT:140
			X:99 = 71
		ENDIF		
	CASE 70
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 213
		ELSE
			X:99 = 70
		ENDIF
	CASE 71
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 214
		ELSE
			X:99 = 71
		ENDIF
	CASE 74
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 211
			SIF TALENT:140
			X:99 = 212
		ELSE
			X:99 = 74
			SIF TALENT:140
			X:99 = 75
		ENDIF
	CASE 75
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 212
		ELSE
			X:99 = 75
		ENDIF
	CASE 76
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 211
			SIF TALENT:140
			X:99 = 212
		ELSE
			X:99 = 76
			SIF TALENT:140
			X:99 = 77
		ENDIF
	CASE 77
		IF TALENT:TARGET:攻 || TALENT:PLAYER:受
			X:99 = 212
		ELSE
			X:99 = 77
		ENDIF
	CASE 79
		X:99 = 79
		SIF TALENT:PLAYER:140
		X:99 = 81	
	CASE 80
		X:99 = 80
		SIF !PENIS(PLAYER)
		X:99 = 79
	CASE 81
		X:99 = 81
		SIF !PENIS(PLAYER)
		X:99 = 79
	CASE 83
		X:99 = 83
		SIF !PENIS(PLAYER)
		X:99 = 86
	CASE 64, 72, 73, 78, 84
		X:99 = 205
		SIF TALENT:PLAYER:140
		X:99 = 213
	CASE 12, 14 TO 19
		X:99 = 206
		SIF TALENT:PLAYER:140
		X:99 = 214
	CASE 21 TO 39	
		X:99 = 211
		SIF TALENT:PLAYER:140
		X:99 = 212	
	CASE 49 TO 59	
		X:99 = 210
	CASE 87 TO 99
		X:99 = 209
		SIF !PENIS(PLAYER)
		X:99 = 1
	CASE 105 TO 107
		X:99 = 202	
	CASEELSE
		X:99 = LOCAL:99
ENDSELECT
	NPC回合 = 1
	TRYCALLFORM COM_ABLE{X:99}
	RESETCOLOR
	TRYCALLFORM COM{X:99}
	RESETCOLOR
	TRYCALLFORM MESSAGE_COM{X:99}
	RESETCOLOR
	PRINTFORML
	CALL 逆推進行中口上
	PRINTFORML
	CALL SOURCE_CHECK
	X:99 = 0
PRINTFORMW

@指令初始化
REPEAT 30
	TFLAG:COUNT = 0
REND
TFLAG:30 = 0
TFLAG:33 = 0
TFLAG:56 = -1
TFLAG:100 = 0
TFLAG:160 = 0
TFLAG:161 = 0
TFLAG:162 = 0
TFLAG:163 = 0
TFLAG:164 = 0
TFLAG:165 = 0